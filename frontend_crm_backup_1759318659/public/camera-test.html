<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Test - Aavana Greens</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        .success { border-color: #4CAF50; background-color: #f0fff0; }
        .error { border-color: #f44336; background-color: #fff0f0; }
        .warning { border-color: #ff9800; background-color: #fff8f0; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        
        video {
            width: 100%;
            max-width: 400px;
            height: 300px;
            background: #000;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .captured-image {
            max-width: 300px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .device-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ Camera Functionality Test</h1>
        <p><strong>Purpose:</strong> Test camera access on your MacBook, mobile, or other device</p>
        
        <div id="deviceSupport" class="test-section">
            <h2>üì± Device Support Check</h2>
            <div id="supportStatus">Checking device compatibility...</div>
        </div>
        
        <div id="cameraAccess" class="test-section">
            <h2>üì∑ Camera Access Test</h2>
            <button id="startCamera">Start Camera</button>
            <button id="stopCamera" disabled>Stop Camera</button>
            <div id="cameraStatus" class="status"></div>
            <video id="videoElement" autoplay playsinline></video>
        </div>
        
        <div id="photoCapture" class="test-section">
            <h2>üì∏ Photo Capture Test</h2>
            <button id="capturePhoto" disabled>Capture Photo</button>
            <div id="captureStatus" class="status"></div>
            <div id="capturedPhotos"></div>
        </div>
        
        <div id="deviceInfo" class="test-section">
            <h2>üîß Device Information</h2>
            <div id="deviceDetails" class="device-info"></div>
        </div>
        
        <div class="test-section">
            <h2>‚úÖ Expected Results</h2>
            <ul>
                <li><strong>MacBook:</strong> Should prompt for camera permission, then show video feed</li>
                <li><strong>iPhone/Android:</strong> Should work with front and back cameras</li>
                <li><strong>Desktop with webcam:</strong> Should show video feed and capture photos</li>
                <li><strong>Any issues?</strong> Check browser permissions and try refreshing</li>
            </ul>
        </div>
    </div>

    <script>
        let stream = null;
        const video = document.getElementById('videoElement');
        const startBtn = document.getElementById('startCamera');
        const stopBtn = document.getElementById('stopCamera');
        const captureBtn = document.getElementById('capturePhoto');
        
        // Device support check
        function checkDeviceSupport() {
            const supportDiv = document.getElementById('supportStatus');
            const deviceSection = document.getElementById('deviceSupport');
            
            let status = '<strong>Device Compatibility:</strong><br>';
            
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                status += '‚úÖ Camera API supported<br>';
                deviceSection.className = 'test-section success';
            } else {
                status += '‚ùå Camera API not supported<br>';
                deviceSection.className = 'test-section error';
            }
            
            if (navigator.geolocation) {
                status += '‚úÖ GPS/Location supported<br>';
            } else {
                status += '‚ùå GPS/Location not supported<br>';
            }
            
            status += `<strong>Browser:</strong> ${navigator.userAgent}<br>`;
            status += `<strong>Platform:</strong> ${navigator.platform}<br>`;
            status += `<strong>Language:</strong> ${navigator.language}<br>`;
            
            supportDiv.innerHTML = status;
        }
        
        // Start camera
        async function startCamera() {
            const statusDiv = document.getElementById('cameraStatus');
            const cameraSection = document.getElementById('cameraAccess');
            
            try {
                statusDiv.innerHTML = 'üîÑ Requesting camera access...';
                statusDiv.className = 'status warning';
                
                // Request camera with ideal settings
                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    },
                    audio: false
                });
                
                video.srcObject = stream;
                
                statusDiv.innerHTML = '‚úÖ Camera access granted! Video feed active';
                statusDiv.className = 'status success';
                cameraSection.className = 'test-section success';
                
                startBtn.disabled = true;
                stopBtn.disabled = false;
                captureBtn.disabled = false;
                
                // Get camera info
                const tracks = stream.getVideoTracks();
                if (tracks.length > 0) {
                    const settings = tracks[0].getSettings();
                    statusDiv.innerHTML += `<br><small>Resolution: ${settings.width}x${settings.height}</small>`;
                }
                
            } catch (error) {
                let errorMsg = '‚ùå Camera access failed: ';
                
                if (error.name === 'NotAllowedError') {
                    errorMsg += 'Permission denied. Please allow camera access.';
                } else if (error.name === 'NotFoundError') {
                    errorMsg += 'No camera found. Please ensure camera is connected.';
                } else if (error.name === 'NotReadableError') {
                    errorMsg += 'Camera is busy. Close other apps using camera.';
                } else {
                    errorMsg += error.message;
                }
                
                statusDiv.innerHTML = errorMsg;
                statusDiv.className = 'status error';
                cameraSection.className = 'test-section error';
            }
        }
        
        // Stop camera
        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                video.srcObject = null;
                
                document.getElementById('cameraStatus').innerHTML = '‚èπÔ∏è Camera stopped';
                document.getElementById('cameraStatus').className = 'status';
                document.getElementById('cameraAccess').className = 'test-section';
                
                startBtn.disabled = false;
                stopBtn.disabled = true;
                captureBtn.disabled = true;
            }
        }
        
        // Capture photo
        function capturePhoto() {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            const captureDiv = document.getElementById('capturedPhotos');
            const statusDiv = document.getElementById('captureStatus');
            const captureSection = document.getElementById('photoCapture');
            
            try {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0);
                
                const dataURL = canvas.toDataURL('image/jpeg', 0.8);
                
                const img = document.createElement('img');
                img.src = dataURL;
                img.className = 'captured-image';
                
                const timestamp = new Date().toLocaleString();
                const photoContainer = document.createElement('div');
                photoContainer.innerHTML = `<p><strong>Photo captured at:</strong> ${timestamp}</p>`;
                photoContainer.appendChild(img);
                
                captureDiv.appendChild(photoContainer);
                
                statusDiv.innerHTML = '‚úÖ Photo captured successfully!';
                statusDiv.className = 'status success';
                captureSection.className = 'test-section success';
                
            } catch (error) {
                statusDiv.innerHTML = '‚ùå Photo capture failed: ' + error.message;
                statusDiv.className = 'status error';
                captureSection.className = 'test-section error';
            }
        }
        
        // Device info
        function showDeviceInfo() {
            const infoDiv = document.getElementById('deviceDetails');
            
            let info = `User Agent: ${navigator.userAgent}\n`;
            info += `Platform: ${navigator.platform}\n`;
            info += `Language: ${navigator.language}\n`;
            info += `Cookie Enabled: ${navigator.cookieEnabled}\n`;
            info += `Online: ${navigator.onLine}\n`;
            info += `Screen: ${screen.width}x${screen.height}\n`;
            info += `Viewport: ${window.innerWidth}x${window.innerHeight}\n`;
            info += `Device Pixel Ratio: ${window.devicePixelRatio}\n`;
            info += `Timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}\n`;
            
            if (navigator.mediaDevices) {
                navigator.mediaDevices.enumerateDevices().then(devices => {
                    const videoDevices = devices.filter(device => device.kind === 'videoinput');
                    info += `\nVideo Devices Found: ${videoDevices.length}\n`;
                    videoDevices.forEach((device, index) => {
                        info += `  ${index + 1}. ${device.label || 'Camera ' + (index + 1)}\n`;
                    });
                    infoDiv.textContent = info;
                });
            } else {
                infoDiv.textContent = info;
            }
        }
        
        // Event listeners
        startBtn.addEventListener('click', startCamera);
        stopBtn.addEventListener('click', stopCamera);
        captureBtn.addEventListener('click', capturePhoto);
        
        // Initialize
        checkDeviceSupport();
        showDeviceInfo();
        
        // Auto-cleanup on page unload
        window.addEventListener('beforeunload', stopCamera);
    </script>
</body>
</html>